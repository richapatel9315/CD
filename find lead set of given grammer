#include <iostream>

using namespace std;
bool checkTerminal(char c)
{  
 if (!isupper(c) && c != '\0' && c != '|') return true;
 else return false;
}

int findProduction(char NT, char **strings, int currentProduction, int nProductions){
  for (int i = 0; i < nProductions; ++i){ 
  if (i == currentProduction)continue;
  if (strings[i][0] == NT)return i;
 } 
}

void checkNTString(char *string, char** strings, int currentProduction, int nProductions)
{
 int i = 2; 
 for (; i < 50; ++i){ 
   if (checkTerminal(string[i])){ 
   cout << string[i] << " ";
   while (string[i] != '|' && string[i] != '\0') i++;   
  }
  else if (string[i] == '|' || string[i] == '\0'){ 
   int productionNo = findProduction(string[i - 1], strings, currentProduction, nProductions); 
   checkNTString(strings[productionNo], strings, productionNo, nProductions);
  }
  if (string[i] == '\0')break;
 }
}

int main()
{
 cout << "Enter the number of non-terminals: ";
 int nProductions = 0;
 cin >> nProductions;

 cout << "Enter the productions: \n";

 char **strings = new char*[nProductions];
 for (int i = 0; i < nProductions; ++i){
  strings[i] = new char[50]; 
  cin >> strings[i];
 } 
  
 for (int i = 0; i < nProductions; ++i){
  cout << "{ ";
  checkNTString(strings[i], strings, i, nProductions);
  cout << "}\n";
 } 

 return 0;
}
